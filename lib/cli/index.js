#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ARCHIVE_NAME = void 0;
const chalk = require("chalk");
const commander_1 = require("commander");
const checkCredentials_1 = require("./checkCredentials");
const createZip_1 = require("./createZip");
const generateCDKDeployerCfnTemplate_1 = require("./generateCDKDeployerCfnTemplate");
const getProjectFiles_1 = require("./getProjectFiles");
const uploadCDKAppZip_1 = require("./uploadCDKAppZip");
exports.ARCHIVE_NAME = 'cdk_app.zip';
async function run() {
    const program = new commander_1.Command()
        .description('A simple tool to make your CDK app deployable through a click to deploy button. \n \n Prerequisite : Export AWS credentials !')
        .option('--github-repo-name <string>', 'Name of the repo example: "aws-samples/aws-cdk-examples"')
        .option('--s3-bucket-name <string>', 'S3 bucket to use to upload the CDK Deployer stack and potentially the zip file. If not provided, one will be created for you after approval.')
        .option('--s3-key-prefix <string>', 'S3 key prefix to use to upload the CDK Deployer stack and potentially the zip file')
        .option('--s3-bucket-region <string>', 'S3 bucket region to use to upload the CDK Deployer stack and potentially the zip file', 'us-east-1')
        .option('--public-read', 'Make the S3 bucket public read', false)
        .option('--github-repo-branch <string>', 'Branch to use', 'main')
        .option('--cdk-project-path <string>', 'Path to the cdk app', './')
        .option('--stack-name <string>', 'Name of the stack to deploy')
        .option('--deploy-buildspec-name <string>', 'Name of the buildspec available in the cdk app to deploy the stack. (Required if --destroy-buildspec-name is provided)')
        .option('--destroy-buildspec-name <string>', 'Name of the buildspec available in the cdk app to destroy the stack. (Required if --deploy-buildspec-name is provided)')
        .option('--install-command <string>', 'Command to run to install dependencies')
        .option('--build-command <string>', 'Command to run to build the cdk app')
        .option('--bootstrap-command <string>', 'Command to run to build the cdk app', 'npx cdk bootstrap --qualifier $CDK_QUALIFIER --toolkit-stack-name CDKToolkit-$CDK_QUALIFIER')
        .option('--deploy-command <string>', 'Command to run to deploy the cdk app', 'npx cdk deploy $PARAMETERS --all --require-approval never -c @aws-cdk/core:bootstrapQualifier=$CDK_QUALIFIER')
        .option('--destroy-command <string>', 'Command to run to destroy the cdk app', 'npx cdk destroy --all --force -c @aws-cdk/core:bootstrapQualifier=$CDK_QUALIFIER')
        .option('--cdk-qualifier <string>', 'CDK qualifier to use', 'deployer')
        .option('--cdk-parameters [pair...]', 'add an entry (or several separated by a space) key=value that will be passed to the cdk app through context (--context)')
        .parse();
    const options = program.opts();
    console.log(JSON.stringify(options));
    console.log('Remaining arguments: ', program.args);
    try {
        await checkCredentials_1.checkGenericAWSCredentials();
        if (!options.githubRepoName && options.s3BucketName && options.s3KeyPrefix) {
            console.log('No github repo name provided for the CDK app to deploy. Will then try to upload it as a zip file');
            console.log(chalk.white('Creating zip file for CDK app ...'));
            const files = getProjectFiles_1.getProjectFiles(options.cdkProjectPath);
            const isCDKAppRoot = files.find((f) => f === 'cdk.json');
            if (!isCDKAppRoot) {
                throw new Error(`No cdk.json file found running \`git ls-files\` in project located at ${process.cwd()}: \n\n did you add your cdk code to git ? are you sure you are on the root of the cdk project ?`);
            }
            await createZip_1.createZip(exports.ARCHIVE_NAME, options.cdkProjectPath, files).catch((e) => {
                throw e;
            });
            await uploadCDKAppZip_1.uploadCDKAppZip(options);
        }
        console.log(chalk.white('Generating the deployer stack ...'));
        const link = await generateCDKDeployerCfnTemplate_1.generateCDKStandaloneDeployerCfnTemplate(options);
        console.info(chalk.green.bold(`You can now add the following markdown to your README.md : [![click-to-deploy](https://img.shields.io/badge/Click%20to-CDK%20Deploy-blue)](https://console.aws.amazon.com/cloudformation/home#/stacks/new?stackName=cdkDeployer&templateURL=${link})`));
    }
    catch (error) {
        console.error(chalk.red.bold(error.message));
        process.exit(1);
    }
}
void run();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY2xpL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFFQSwrQkFBK0I7QUFDL0IseUNBQW9DO0FBQ3BDLHlEQUFnRTtBQUNoRSwyQ0FBd0M7QUFDeEMscUZBQTRGO0FBQzVGLHVEQUFvRDtBQUNwRCx1REFBb0Q7QUFFdkMsUUFBQSxZQUFZLEdBQUcsYUFBYSxDQUFDO0FBc0IxQyxLQUFLLFVBQVUsR0FBRztJQUNoQixNQUFNLE9BQU8sR0FBRyxJQUFJLG1CQUFPLEVBQUU7U0FDMUIsV0FBVyxDQUNWLCtIQUErSCxDQUNoSTtTQUNBLE1BQU0sQ0FBQyw2QkFBNkIsRUFBRSwwREFBMEQsQ0FBQztTQUNqRyxNQUFNLENBQ0wsMkJBQTJCLEVBQzNCLDhJQUE4SSxDQUMvSTtTQUNBLE1BQU0sQ0FDTCwwQkFBMEIsRUFDMUIsb0ZBQW9GLENBQ3JGO1NBQ0EsTUFBTSxDQUNMLDZCQUE2QixFQUM3Qix1RkFBdUYsRUFDdkYsV0FBVyxDQUNaO1NBQ0EsTUFBTSxDQUFDLGVBQWUsRUFBRSxnQ0FBZ0MsRUFBRSxLQUFLLENBQUM7U0FDaEUsTUFBTSxDQUFDLCtCQUErQixFQUFFLGVBQWUsRUFBRSxNQUFNLENBQUM7U0FDaEUsTUFBTSxDQUFDLDZCQUE2QixFQUFFLHFCQUFxQixFQUFFLElBQUksQ0FBQztTQUNsRSxNQUFNLENBQUMsdUJBQXVCLEVBQUUsNkJBQTZCLENBQUM7U0FDOUQsTUFBTSxDQUFDLGtDQUFrQyxFQUFFLHdIQUF3SCxDQUFDO1NBQ3BLLE1BQU0sQ0FBQyxtQ0FBbUMsRUFBRSx3SEFBd0gsQ0FBQztTQUNySyxNQUFNLENBQUMsNEJBQTRCLEVBQUUsd0NBQXdDLENBQUM7U0FDOUUsTUFBTSxDQUFDLDBCQUEwQixFQUFFLHFDQUFxQyxDQUFDO1NBQ3pFLE1BQU0sQ0FBQyw4QkFBOEIsRUFBRSxxQ0FBcUMsRUFBRSw2RkFBNkYsQ0FBQztTQUM1SyxNQUFNLENBQUMsMkJBQTJCLEVBQUUsc0NBQXNDLEVBQUUsOEdBQThHLENBQUM7U0FDM0wsTUFBTSxDQUFDLDRCQUE0QixFQUFFLHVDQUF1QyxFQUFFLGtGQUFrRixDQUFDO1NBQ2pLLE1BQU0sQ0FBQywwQkFBMEIsRUFBRSxzQkFBc0IsRUFBRSxVQUFVLENBQUM7U0FDdEUsTUFBTSxDQUFDLDRCQUE0QixFQUFFLHlIQUF5SCxDQUFDO1NBQy9KLEtBQUssRUFBRSxDQUFDO0lBRVgsTUFBTSxPQUFPLEdBQVEsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRW5ELElBQUk7UUFDRixNQUFNLDZDQUEwQixFQUFFLENBQUM7UUFFbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLElBQUksT0FBTyxDQUFDLFlBQVksSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFO1lBQzFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0dBQWtHLENBQUMsQ0FBQztZQUVoSCxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsbUNBQW1DLENBQUMsQ0FBQyxDQUFDO1lBRTlELE1BQU0sS0FBSyxHQUFHLGlDQUFlLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBRXRELE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxVQUFVLENBQUMsQ0FBQztZQUV6RCxJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNqQixNQUFNLElBQUksS0FBSyxDQUNiLHlFQUF5RSxPQUFPLENBQUMsR0FBRyxFQUFFLGlHQUFpRyxDQUN4TCxDQUFDO2FBQ0g7WUFFRCxNQUFNLHFCQUFTLENBQUMsb0JBQVksRUFBRSxPQUFPLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO2dCQUN2RSxNQUFNLENBQUMsQ0FBQztZQUNWLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxpQ0FBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLG1DQUFtQyxDQUFDLENBQUMsQ0FBQztRQUM5RCxNQUFNLElBQUksR0FBRyxNQUFNLHlFQUF3QyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3JFLE9BQU8sQ0FBQyxJQUFJLENBQ1YsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQ2QsK09BQStPLElBQUksR0FBRyxDQUN2UCxDQUNGLENBQUM7S0FDSDtJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBRSxLQUFlLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUN4RCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ2pCO0FBQ0gsQ0FBQztBQUVELEtBQUssR0FBRyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5cbmltcG9ydCAqIGFzIGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCB7IENvbW1hbmQgfSBmcm9tICdjb21tYW5kZXInO1xuaW1wb3J0IHsgY2hlY2tHZW5lcmljQVdTQ3JlZGVudGlhbHMgfSBmcm9tICcuL2NoZWNrQ3JlZGVudGlhbHMnO1xuaW1wb3J0IHsgY3JlYXRlWmlwIH0gZnJvbSAnLi9jcmVhdGVaaXAnO1xuaW1wb3J0IHsgZ2VuZXJhdGVDREtTdGFuZGFsb25lRGVwbG95ZXJDZm5UZW1wbGF0ZSB9IGZyb20gJy4vZ2VuZXJhdGVDREtEZXBsb3llckNmblRlbXBsYXRlJztcbmltcG9ydCB7IGdldFByb2plY3RGaWxlcyB9IGZyb20gJy4vZ2V0UHJvamVjdEZpbGVzJztcbmltcG9ydCB7IHVwbG9hZENES0FwcFppcCB9IGZyb20gJy4vdXBsb2FkQ0RLQXBwWmlwJztcblxuZXhwb3J0IGNvbnN0IEFSQ0hJVkVfTkFNRSA9ICdjZGtfYXBwLnppcCc7XG5cbmV4cG9ydCB0eXBlIENMSU9wdGlvbnMgPSB7XG4gIGdpdGh1YlJlcG9OYW1lOiBzdHJpbmc7XG4gIHMzQnVja2V0TmFtZT86IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgczNLZXlQcmVmaXg/OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIHMzQnVja2V0UmVnaW9uOiBzdHJpbmc7XG4gIHB1YmxpY1JlYWQ6IGJvb2xlYW47XG4gIGdpdGh1YlJlcG9CcmFuY2g6IHN0cmluZztcbiAgY2RrUHJvamVjdFBhdGg6IHN0cmluZztcbiAgc3RhY2tOYW1lPzogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBkZXBsb3lCdWlsZHNwZWNOYW1lPzogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBkZXN0cm95QnVpbGRzcGVjTmFtZT86IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgaW5zdGFsbENvbW1hbmQ/OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGJ1aWxkQ29tbWFuZD86IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgZGVwbG95Q29tbWFuZD86IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgZGVzdHJveUNvbW1hbmQ/OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGJvb3RzdHJhcENvbW1hbmQ/OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGNka1F1YWxpZmllcj86IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgY2RrUGFyYW1ldGVycz86IFtzdHJpbmddIHwgdW5kZWZpbmVkO1xufTtcblxuYXN5bmMgZnVuY3Rpb24gcnVuKCkge1xuICBjb25zdCBwcm9ncmFtID0gbmV3IENvbW1hbmQoKVxuICAgIC5kZXNjcmlwdGlvbihcbiAgICAgICdBIHNpbXBsZSB0b29sIHRvIG1ha2UgeW91ciBDREsgYXBwIGRlcGxveWFibGUgdGhyb3VnaCBhIGNsaWNrIHRvIGRlcGxveSBidXR0b24uIFxcbiBcXG4gUHJlcmVxdWlzaXRlIDogRXhwb3J0IEFXUyBjcmVkZW50aWFscyAhJyxcbiAgICApXG4gICAgLm9wdGlvbignLS1naXRodWItcmVwby1uYW1lIDxzdHJpbmc+JywgJ05hbWUgb2YgdGhlIHJlcG8gZXhhbXBsZTogXCJhd3Mtc2FtcGxlcy9hd3MtY2RrLWV4YW1wbGVzXCInKVxuICAgIC5vcHRpb24oXG4gICAgICAnLS1zMy1idWNrZXQtbmFtZSA8c3RyaW5nPicsXG4gICAgICAnUzMgYnVja2V0IHRvIHVzZSB0byB1cGxvYWQgdGhlIENESyBEZXBsb3llciBzdGFjayBhbmQgcG90ZW50aWFsbHkgdGhlIHppcCBmaWxlLiBJZiBub3QgcHJvdmlkZWQsIG9uZSB3aWxsIGJlIGNyZWF0ZWQgZm9yIHlvdSBhZnRlciBhcHByb3ZhbC4nLFxuICAgIClcbiAgICAub3B0aW9uKFxuICAgICAgJy0tczMta2V5LXByZWZpeCA8c3RyaW5nPicsXG4gICAgICAnUzMga2V5IHByZWZpeCB0byB1c2UgdG8gdXBsb2FkIHRoZSBDREsgRGVwbG95ZXIgc3RhY2sgYW5kIHBvdGVudGlhbGx5IHRoZSB6aXAgZmlsZScsXG4gICAgKVxuICAgIC5vcHRpb24oXG4gICAgICAnLS1zMy1idWNrZXQtcmVnaW9uIDxzdHJpbmc+JyxcbiAgICAgICdTMyBidWNrZXQgcmVnaW9uIHRvIHVzZSB0byB1cGxvYWQgdGhlIENESyBEZXBsb3llciBzdGFjayBhbmQgcG90ZW50aWFsbHkgdGhlIHppcCBmaWxlJyxcbiAgICAgICd1cy1lYXN0LTEnLFxuICAgIClcbiAgICAub3B0aW9uKCctLXB1YmxpYy1yZWFkJywgJ01ha2UgdGhlIFMzIGJ1Y2tldCBwdWJsaWMgcmVhZCcsIGZhbHNlKVxuICAgIC5vcHRpb24oJy0tZ2l0aHViLXJlcG8tYnJhbmNoIDxzdHJpbmc+JywgJ0JyYW5jaCB0byB1c2UnLCAnbWFpbicpXG4gICAgLm9wdGlvbignLS1jZGstcHJvamVjdC1wYXRoIDxzdHJpbmc+JywgJ1BhdGggdG8gdGhlIGNkayBhcHAnLCAnLi8nKVxuICAgIC5vcHRpb24oJy0tc3RhY2stbmFtZSA8c3RyaW5nPicsICdOYW1lIG9mIHRoZSBzdGFjayB0byBkZXBsb3knKVxuICAgIC5vcHRpb24oJy0tZGVwbG95LWJ1aWxkc3BlYy1uYW1lIDxzdHJpbmc+JywgJ05hbWUgb2YgdGhlIGJ1aWxkc3BlYyBhdmFpbGFibGUgaW4gdGhlIGNkayBhcHAgdG8gZGVwbG95IHRoZSBzdGFjay4gKFJlcXVpcmVkIGlmIC0tZGVzdHJveS1idWlsZHNwZWMtbmFtZSBpcyBwcm92aWRlZCknKVxuICAgIC5vcHRpb24oJy0tZGVzdHJveS1idWlsZHNwZWMtbmFtZSA8c3RyaW5nPicsICdOYW1lIG9mIHRoZSBidWlsZHNwZWMgYXZhaWxhYmxlIGluIHRoZSBjZGsgYXBwIHRvIGRlc3Ryb3kgdGhlIHN0YWNrLiAoUmVxdWlyZWQgaWYgLS1kZXBsb3ktYnVpbGRzcGVjLW5hbWUgaXMgcHJvdmlkZWQpJylcbiAgICAub3B0aW9uKCctLWluc3RhbGwtY29tbWFuZCA8c3RyaW5nPicsICdDb21tYW5kIHRvIHJ1biB0byBpbnN0YWxsIGRlcGVuZGVuY2llcycpXG4gICAgLm9wdGlvbignLS1idWlsZC1jb21tYW5kIDxzdHJpbmc+JywgJ0NvbW1hbmQgdG8gcnVuIHRvIGJ1aWxkIHRoZSBjZGsgYXBwJylcbiAgICAub3B0aW9uKCctLWJvb3RzdHJhcC1jb21tYW5kIDxzdHJpbmc+JywgJ0NvbW1hbmQgdG8gcnVuIHRvIGJ1aWxkIHRoZSBjZGsgYXBwJywgJ25weCBjZGsgYm9vdHN0cmFwIC0tcXVhbGlmaWVyICRDREtfUVVBTElGSUVSIC0tdG9vbGtpdC1zdGFjay1uYW1lIENES1Rvb2xraXQtJENES19RVUFMSUZJRVInKVxuICAgIC5vcHRpb24oJy0tZGVwbG95LWNvbW1hbmQgPHN0cmluZz4nLCAnQ29tbWFuZCB0byBydW4gdG8gZGVwbG95IHRoZSBjZGsgYXBwJywgJ25weCBjZGsgZGVwbG95ICRQQVJBTUVURVJTIC0tYWxsIC0tcmVxdWlyZS1hcHByb3ZhbCBuZXZlciAtYyBAYXdzLWNkay9jb3JlOmJvb3RzdHJhcFF1YWxpZmllcj0kQ0RLX1FVQUxJRklFUicpXG4gICAgLm9wdGlvbignLS1kZXN0cm95LWNvbW1hbmQgPHN0cmluZz4nLCAnQ29tbWFuZCB0byBydW4gdG8gZGVzdHJveSB0aGUgY2RrIGFwcCcsICducHggY2RrIGRlc3Ryb3kgLS1hbGwgLS1mb3JjZSAtYyBAYXdzLWNkay9jb3JlOmJvb3RzdHJhcFF1YWxpZmllcj0kQ0RLX1FVQUxJRklFUicpXG4gICAgLm9wdGlvbignLS1jZGstcXVhbGlmaWVyIDxzdHJpbmc+JywgJ0NESyBxdWFsaWZpZXIgdG8gdXNlJywgJ2RlcGxveWVyJylcbiAgICAub3B0aW9uKCctLWNkay1wYXJhbWV0ZXJzIFtwYWlyLi4uXScsICdhZGQgYW4gZW50cnkgKG9yIHNldmVyYWwgc2VwYXJhdGVkIGJ5IGEgc3BhY2UpIGtleT12YWx1ZSB0aGF0IHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBjZGsgYXBwIHRocm91Z2ggY29udGV4dCAoLS1jb250ZXh0KScpXG4gICAgLnBhcnNlKCk7XG5cbiAgY29uc3Qgb3B0aW9uczogYW55ID0gcHJvZ3JhbS5vcHRzKCk7XG4gIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpKTtcbiAgY29uc29sZS5sb2coJ1JlbWFpbmluZyBhcmd1bWVudHM6ICcsIHByb2dyYW0uYXJncyk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBjaGVja0dlbmVyaWNBV1NDcmVkZW50aWFscygpO1xuXG4gICAgaWYgKCFvcHRpb25zLmdpdGh1YlJlcG9OYW1lICYmIG9wdGlvbnMuczNCdWNrZXROYW1lICYmIG9wdGlvbnMuczNLZXlQcmVmaXgpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdObyBnaXRodWIgcmVwbyBuYW1lIHByb3ZpZGVkIGZvciB0aGUgQ0RLIGFwcCB0byBkZXBsb3kuIFdpbGwgdGhlbiB0cnkgdG8gdXBsb2FkIGl0IGFzIGEgemlwIGZpbGUnKTtcblxuICAgICAgY29uc29sZS5sb2coY2hhbGsud2hpdGUoJ0NyZWF0aW5nIHppcCBmaWxlIGZvciBDREsgYXBwIC4uLicpKTtcblxuICAgICAgY29uc3QgZmlsZXMgPSBnZXRQcm9qZWN0RmlsZXMob3B0aW9ucy5jZGtQcm9qZWN0UGF0aCk7XG5cbiAgICAgIGNvbnN0IGlzQ0RLQXBwUm9vdCA9IGZpbGVzLmZpbmQoKGYpID0+IGYgPT09ICdjZGsuanNvbicpO1xuXG4gICAgICBpZiAoIWlzQ0RLQXBwUm9vdCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYE5vIGNkay5qc29uIGZpbGUgZm91bmQgcnVubmluZyBcXGBnaXQgbHMtZmlsZXNcXGAgaW4gcHJvamVjdCBsb2NhdGVkIGF0ICR7cHJvY2Vzcy5jd2QoKX06IFxcblxcbiBkaWQgeW91IGFkZCB5b3VyIGNkayBjb2RlIHRvIGdpdCA/IGFyZSB5b3Ugc3VyZSB5b3UgYXJlIG9uIHRoZSByb290IG9mIHRoZSBjZGsgcHJvamVjdCA/YFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBhd2FpdCBjcmVhdGVaaXAoQVJDSElWRV9OQU1FLCBvcHRpb25zLmNka1Byb2plY3RQYXRoLCBmaWxlcykuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgdXBsb2FkQ0RLQXBwWmlwKG9wdGlvbnMpO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGNoYWxrLndoaXRlKCdHZW5lcmF0aW5nIHRoZSBkZXBsb3llciBzdGFjayAuLi4nKSk7XG4gICAgY29uc3QgbGluayA9IGF3YWl0IGdlbmVyYXRlQ0RLU3RhbmRhbG9uZURlcGxveWVyQ2ZuVGVtcGxhdGUob3B0aW9ucyk7XG4gICAgY29uc29sZS5pbmZvKFxuICAgICAgY2hhbGsuZ3JlZW4uYm9sZChcbiAgICAgICAgYFlvdSBjYW4gbm93IGFkZCB0aGUgZm9sbG93aW5nIG1hcmtkb3duIHRvIHlvdXIgUkVBRE1FLm1kIDogWyFbY2xpY2stdG8tZGVwbG95XShodHRwczovL2ltZy5zaGllbGRzLmlvL2JhZGdlL0NsaWNrJTIwdG8tQ0RLJTIwRGVwbG95LWJsdWUpXShodHRwczovL2NvbnNvbGUuYXdzLmFtYXpvbi5jb20vY2xvdWRmb3JtYXRpb24vaG9tZSMvc3RhY2tzL25ldz9zdGFja05hbWU9Y2RrRGVwbG95ZXImdGVtcGxhdGVVUkw9JHtsaW5rfSlgLFxuICAgICAgKSxcbiAgICApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoY2hhbGsucmVkLmJvbGQoKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlKSk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG59XG5cbnZvaWQgcnVuKCk7XG4iXX0=